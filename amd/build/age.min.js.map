{"version":3,"file":"age.min.js","sources":["../src/age.js"],"sourcesContent":["// Part of Moodle - AI4Teachers block\n/**\n * Age modal logic separated from orchestrator.\n * @module block_aipromptgen/age\n */\n\nconst $ = (sel, root = document) => root.querySelector(sel);\n\nclass SimpleModal {\n    constructor(id) {\n        this.node = document.getElementById(id);\n        this.backdrop = document.getElementById('ai4t-modal-backdrop');\n    }\n    open(prefill) {\n        if (!this.node) {\n            return;\n        }\n        if (typeof prefill === 'function') {\n            try {\n                prefill();\n            } catch (e) {\n                // Ignore prefill errors.\n            }\n        }\n        this.node.style.display = 'block';\n        if (this.backdrop) {\n            this.backdrop.style.display = 'block';\n        }\n        this.node.focus();\n    }\n    close() {\n        if (!this.node) {\n            return;\n        }\n        this.node.style.display = 'none';\n        if (this.backdrop) {\n            this.backdrop.style.display = 'none';\n        }\n    }\n}\n\nexport const initAgeModal = () => {\n    const modal = new SimpleModal('ai4t-age-modal');\n    const openBtn = $('#ai4t-age-browse');\n    const closeBtn = $('#ai4t-age-modal-close');\n    const cancelBtn = $('#ai4t-age-modal-cancel');\n    const insertBtn = $('#ai4t-age-modal-insert');\n    const input = $('#id_agerange');\n    const exact = $('#ai4t-age-exact');\n    const from = $('#ai4t-age-from');\n    const to = $('#ai4t-age-to');\n    const modeExact = $('#ai4t-age-mode-exact');\n    const modeRange = $('#ai4t-age-mode-range');\n\n    const syncEnabled = () => {\n        const useExact = modeExact?.checked;\n        if (useExact) {\n            exact?.removeAttribute('disabled');\n            from?.setAttribute('disabled', 'disabled');\n            to?.setAttribute('disabled', 'disabled');\n            return;\n        }\n        exact?.setAttribute('disabled', 'disabled');\n        from?.removeAttribute('disabled');\n        to?.removeAttribute('disabled');\n    };\n\n    const prefill = () => {\n        if (!input) {\n            return;\n        }\n        const v = (input.value || '').trim();\n        if (!v) {\n            if (modeExact) {\n                modeExact.checked = true;\n            }\n            exact.value = '';\n            from.value = '';\n            to.value = '';\n            syncEnabled();\n            return;\n        }\n        if (/^\\d+$/.test(v)) {\n            exact.value = v;\n            from.value = '';\n            to.value = '';\n            if (modeExact) {\n                modeExact.checked = true;\n            }\n            syncEnabled();\n            return;\n        }\n        const m = v.match(/^\\s*(\\d+)\\s*[-\\u2013]\\s*(\\d+)\\s*$/u);\n        if (m) {\n            exact.value = '';\n            from.value = m[1];\n            to.value = m[2];\n            if (modeRange) {\n                modeRange.checked = true;\n            }\n            syncEnabled();\n            return;\n        }\n        if (modeExact) {\n            modeExact.checked = true;\n        }\n        exact.value = '';\n        from.value = '';\n        to.value = '';\n        syncEnabled();\n    };\n\n    const onInsert = () => {\n        if (!input) {\n            modal.close();\n            return;\n        }\n        const ev = (exact.value || '').trim();\n        const fv = (from.value || '').trim();\n        const tv = (to.value || '').trim();\n        const useExact = modeExact?.checked;\n        if (useExact && ev) {\n            input.value = ev;\n            modal.close();\n            return;\n        }\n        if (!useExact && fv && tv) {\n            let a = parseInt(fv, 10);\n            let b = parseInt(tv, 10);\n            if (!Number.isNaN(a) && !Number.isNaN(b)) {\n                if (a > b) {\n                    [a, b] = [b, a];\n                }\n                input.value = `${a}-${b}`;\n                modal.close();\n                return;\n            }\n        }\n        modal.close();\n    };\n\n    openBtn?.addEventListener('click', e => {\n        e.preventDefault();\n        e.stopPropagation();\n        modal.open(prefill);\n    });\n    closeBtn?.addEventListener('click', () => modal.close());\n    cancelBtn?.addEventListener('click', () => modal.close());\n    insertBtn?.addEventListener('click', onInsert);\n    modeExact?.addEventListener('change', syncEnabled);\n    modeRange?.addEventListener('change', syncEnabled);\n    document.addEventListener('keydown', ev => {\n        if (ev.key === 'Escape') {\n            modal.close();\n        }\n    });\n};\n"],"names":["$","sel","root","document","querySelector","SimpleModal","constructor","id","node","getElementById","backdrop","open","prefill","this","e","style","display","focus","close","modal","openBtn","closeBtn","cancelBtn","insertBtn","input","exact","from","to","modeExact","modeRange","syncEnabled","checked","removeAttribute","setAttribute","v","value","trim","test","m","match","addEventListener","preventDefault","stopPropagation","ev","fv","tv","useExact","a","parseInt","b","Number","isNaN","key"],"mappings":"0JAMMA,EAAI,SAACC,SAAKC,4DAAOC,gBAAaD,KAAKE,cAAcH,YAEjDI,YACFC,YAAYC,SACHC,KAAOL,SAASM,eAAeF,SAC/BG,SAAWP,SAASM,eAAe,uBAE5CE,KAAKC,YACIC,KAAKL,SAGa,mBAAZI,YAEHA,UACF,MAAOE,SAIRN,KAAKO,MAAMC,QAAU,QACtBH,KAAKH,gBACAA,SAASK,MAAMC,QAAU,cAE7BR,KAAKS,SAEdC,QACSL,KAAKL,YAGLA,KAAKO,MAAMC,QAAU,OACtBH,KAAKH,gBACAA,SAASK,MAAMC,QAAU,gCAKd,WAClBG,MAAQ,IAAId,YAAY,kBACxBe,QAAUpB,EAAE,oBACZqB,SAAWrB,EAAE,yBACbsB,UAAYtB,EAAE,0BACduB,UAAYvB,EAAE,0BACdwB,MAAQxB,EAAE,gBACVyB,MAAQzB,EAAE,mBACV0B,KAAO1B,EAAE,kBACT2B,GAAK3B,EAAE,gBACP4B,UAAY5B,EAAE,wBACd6B,UAAY7B,EAAE,wBAEd8B,YAAc,QACCF,MAAAA,iBAAAA,UAAWG,eAExBN,MAAAA,OAAAA,MAAOO,gBAAgB,YACvBN,MAAAA,MAAAA,KAAMO,aAAa,WAAY,iBAC/BN,MAAAA,IAAAA,GAAIM,aAAa,WAAY,aAGjCR,MAAAA,OAAAA,MAAOQ,aAAa,WAAY,YAChCP,MAAAA,MAAAA,KAAMM,gBAAgB,YACtBL,MAAAA,IAAAA,GAAIK,gBAAgB,aAGlBpB,QAAU,SACPY,mBAGCU,GAAKV,MAAMW,OAAS,IAAIC,WACzBF,SACGN,YACAA,UAAUG,SAAU,GAExBN,MAAMU,MAAQ,GACdT,KAAKS,MAAQ,GACbR,GAAGQ,MAAQ,QACXL,iBAGA,QAAQO,KAAKH,UACbT,MAAMU,MAAQD,EACdR,KAAKS,MAAQ,GACbR,GAAGQ,MAAQ,GACPP,YACAA,UAAUG,SAAU,QAExBD,oBAGEQ,EAAIJ,EAAEK,MAAM,yCACdD,SACAb,MAAMU,MAAQ,GACdT,KAAKS,MAAQG,EAAE,GACfX,GAAGQ,MAAQG,EAAE,GACTT,YACAA,UAAUE,SAAU,QAExBD,cAGAF,YACAA,UAAUG,SAAU,GAExBN,MAAMU,MAAQ,GACdT,KAAKS,MAAQ,GACbR,GAAGQ,MAAQ,GACXL,eAgCJV,MAAAA,SAAAA,QAASoB,iBAAiB,SAAS1B,IAC/BA,EAAE2B,iBACF3B,EAAE4B,kBACFvB,MAAMR,KAAKC,YAEfS,MAAAA,UAAAA,SAAUmB,iBAAiB,SAAS,IAAMrB,MAAMD,UAChDI,MAAAA,WAAAA,UAAWkB,iBAAiB,SAAS,IAAMrB,MAAMD,UACjDK,MAAAA,WAAAA,UAAWiB,iBAAiB,SApCX,SACRhB,kBACDL,MAAMD,cAGJyB,IAAMlB,MAAMU,OAAS,IAAIC,OACzBQ,IAAMlB,KAAKS,OAAS,IAAIC,OACxBS,IAAMlB,GAAGQ,OAAS,IAAIC,OACtBU,SAAWlB,MAAAA,iBAAAA,UAAWG,WACxBe,UAAYH,UACZnB,MAAMW,MAAQQ,QACdxB,MAAMD,YAGL4B,UAAYF,IAAMC,GAAI,KACnBE,EAAIC,SAASJ,GAAI,IACjBK,EAAID,SAASH,GAAI,QAChBK,OAAOC,MAAMJ,KAAOG,OAAOC,MAAMF,UAC9BF,EAAIE,KACHF,EAAGE,GAAK,CAACA,EAAGF,IAEjBvB,MAAMW,gBAAWY,cAAKE,QACtB9B,MAAMD,QAIdC,MAAMD,WAWVU,MAAAA,WAAAA,UAAWY,iBAAiB,SAAUV,aACtCD,MAAAA,WAAAA,UAAWW,iBAAiB,SAAUV,aACtC3B,SAASqC,iBAAiB,WAAWG,KAClB,WAAXA,GAAGS,KACHjC,MAAMD"}