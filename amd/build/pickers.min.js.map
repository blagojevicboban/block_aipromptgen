{"version":3,"file":"pickers.min.js","sources":["../src/pickers.js"],"sourcesContent":["// Part of Moodle - AI4Teachers block\n/**\n * Generic picker + outcomes + language modal logic.\n * @module block_aipromptgen/pickers\n */\n\nconst $ = (sel, root = document) => root.querySelector(sel);\nconst $$ = (sel, root = document) => Array.from(root.querySelectorAll(sel));\n\n/**\n * Generic single-value picker binding.\n * @param {Object} config\n */\nexport const attachPicker = (config) => {\n    const {\n        openId, modalId, closeId, cancelId,\n        itemSelector, targetId, backdropId = 'ai4t-modal-backdrop'\n    } = config;\n    const openBtn = document.getElementById(openId);\n    const modal = document.getElementById(modalId);\n    const backdrop = document.getElementById(backdropId);\n    const closeBtn = document.getElementById(closeId);\n    const cancelBtn = document.getElementById(cancelId);\n    const target = document.getElementById(targetId);\n\n    const open = () => {\n        if (modal && backdrop) {\n            modal.style.display = 'block';\n            backdrop.style.display = 'block';\n            modal.focus();\n        }\n    };\n    const close = () => {\n        if (modal && backdrop) {\n            modal.style.display = 'none';\n            backdrop.style.display = 'none';\n        }\n    };\n    const pick = (el) => {\n        const v = el.getAttribute('data-value');\n        if (target && v !== null) {\n            target.value = v;\n        }\n        close();\n    };\n\n        openBtn?.addEventListener('click', e => {\n            e.preventDefault();\n            e.stopPropagation();\n            open();\n        });\n    closeBtn?.addEventListener('click', close);\n    cancelBtn?.addEventListener('click', close);\n    backdrop?.addEventListener('click', close);\n    document.addEventListener('keydown', ev => {\n        if (ev.key === 'Escape') {\n            close();\n        }\n    });\n    $$(itemSelector).forEach(li => {\n        li.addEventListener('click', () => pick(li));\n        li.addEventListener('keydown', ev => {\n            if (ev.key === 'Enter' || ev.key === ' ') {\n                ev.preventDefault();\n                pick(li);\n            }\n        });\n    });\n};\n\n/**\n * Attach outcomes multi-select modal behaviour.\n */\nexport const attachOutcomesModal = () => {\n    const openBtn = $('#ai4t-outcomes-browse');\n    const modal = $('#ai4t-outcomes-modal');\n    const backdrop = $('#ai4t-modal-backdrop');\n    const closeBtn = $('#ai4t-outcomes-modal-close');\n    const cancelBtn = $('#ai4t-outcomes-modal-cancel');\n    const insertBtn = $('#ai4t-outcomes-modal-insert');\n    const ta = $('#id_outcomes');\n\n    const open = () => {\n        if (modal && backdrop) {\n            modal.style.display = 'block';\n            backdrop.style.display = 'block';\n            modal.focus();\n        }\n    };\n    const close = () => {\n        if (modal && backdrop) {\n            modal.style.display = 'none';\n            backdrop.style.display = 'none';\n        }\n    };\n\n    openBtn?.addEventListener('click', e => {\n        e.preventDefault();\n        e.stopPropagation();\n        open();\n    });\n    closeBtn?.addEventListener('click', close);\n    cancelBtn?.addEventListener('click', close);\n        insertBtn?.addEventListener('click', () => {\n            if (!ta) {\n                close();\n                return;\n            }\n            const vals = $$('.ai4t-outcome-checkbox:checked').map(cb => cb.value).filter(Boolean);\n            if (!vals.length) {\n                close();\n                return;\n            }\n            let cur = ta.value || '';\n            if (cur && !/\\n$/.test(cur)) {\n                cur += '\\n';\n            }\n            ta.value = cur + vals.join('\\n');\n            close();\n        });\n    backdrop?.addEventListener('click', close);\n    document.addEventListener('keydown', ev => {\n        if (ev.key === 'Escape') {\n            close();\n        }\n    });\n};\n\n/**\n * Attach language modal + sync logic.\n */\nexport const initLanguageModal = () => {\n    const openBtn = $('#ai4t-language-browse');\n    const modal = $('#ai4t-language-modal');\n    const backdrop = $('#ai4t-modal-backdrop');\n    const closeBtn = $('#ai4t-language-modal-close');\n    const cancelBtn = $('#ai4t-language-modal-cancel');\n    const input = $('#id_language');\n    const codeEl = $('#id_languagecode');\n\n    const open = () => {\n        if (modal && backdrop) {\n            modal.style.display = 'block';\n            backdrop.style.display = 'block';\n            modal.focus();\n        }\n    };\n    const close = () => {\n        if (modal && backdrop) {\n            modal.style.display = 'none';\n            backdrop.style.display = 'none';\n        }\n    };\n        const sync = () => {\n            if (!input || !codeEl) {\n                return;\n            }\n            const t = (input.value || '').trim();\n            if (!t) {\n                return;\n            }\n            const m = t.match(/\\(([a-z]{2,3}(?:[_-][a-z]{2,3})?)\\)/i);\n            if (m) {\n                codeEl.value = m[1].replace('-', '_').toLowerCase();\n                return;\n            }\n            $$('.ai4t-language-item').some(li => {\n                const name = li.getAttribute('data-name') || '';\n                if (name.toLowerCase() === t.toLowerCase()) {\n                    codeEl.value = li.getAttribute('data-code');\n                    return true;\n                }\n                return false;\n            });\n        };\n\n    openBtn?.addEventListener('click', e => {\n        e.preventDefault();\n        e.stopPropagation();\n        open();\n    });\n    closeBtn?.addEventListener('click', close);\n    cancelBtn?.addEventListener('click', close);\n    backdrop?.addEventListener('click', close);\n    document.addEventListener('keydown', ev => {\n        if (ev.key === 'Escape') {\n            close();\n        }\n    });\n    $$('.ai4t-language-item').forEach(li => {\n        li.addEventListener('click', () => {\n            if (input) {\n                input.value = li.getAttribute('data-name') || '';\n            }\n            if (codeEl) {\n                codeEl.value = li.getAttribute('data-code') || '';\n            }\n            close();\n        });\n        li.addEventListener('keydown', ev => {\n            if (ev.key === 'Enter' || ev.key === ' ') {\n                ev.preventDefault();\n                li.click();\n            }\n        });\n    });\n    input?.addEventListener('blur', sync);\n    input?.addEventListener('change', sync);\n};\n"],"names":["$","sel","root","document","querySelector","$$","Array","from","querySelectorAll","config","openId","modalId","closeId","cancelId","itemSelector","targetId","backdropId","openBtn","getElementById","modal","backdrop","closeBtn","cancelBtn","target","close","style","display","pick","el","v","getAttribute","value","addEventListener","e","preventDefault","stopPropagation","focus","ev","key","forEach","li","insertBtn","ta","vals","map","cb","filter","Boolean","length","cur","test","join","input","codeEl","sync","t","trim","m","match","replace","toLowerCase","some","click"],"mappings":"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"}